<div class="col-12 col-sm-6 col-lg-4">
    <div class="card product-card h-100 position-relative">
        <span class="badge text-bg-light category-badge">{{ producto.get_categoria_display }}</span>

        <a href="{% url 'product_details' producto.pk %}">
            {% if producto.imagen %}
            <img src="{{ producto.imagen.url }}" class="card-img-top" alt="{{ producto.nombre }}">
            {% else %}
            <img src="https://via.placeholder.com/600x400?text=Sin+imagen" class="card-img-top" alt="Sin imagen">
            {% endif %}
        </a>

        <div class="card-body d-flex flex-column">
            <h5 class="card-title mb-1">{{ producto.nombre }}</h5>
            <p class="text-muted mb-2">Publicado por {{ producto.user.username }} â€¢ {{ producto.creado_en|date:"d/m/Y" }}</p>
            <p class="card-text mb-3">{{ producto.descripcion|default:"Sin descripciÃ³n"|truncatewords:22 }}</p>
            <div class="d-flex justify-content-between align-items-center mt-auto">
                <span class="price">${{ producto.precio }}</span>
                <span class="stock {{ producto.stock|yesno:'text-success,text-danger' }}">Stock: {{ producto.stock }}</span>
            </div>
        </div>

        <div class="card-footer bg-transparent">
            <div class="d-flex justify-content-between gap-2">
                <a href="{% url 'product_details' producto.pk %}" class="btn btn-sm btn-outline-primary">Ver detalle</a>

                {% if producto.user == request.user %}
                    <a href="{% url 'editar-producto' producto.pk %}" class="btn btn-sm btn-outline-secondary">Editar</a>
                {% else %}
                    {% if user.is_authenticated %}
                        <form method="post" action="{% url 'aÃ±adir-al-carrito-desde-lista' producto.pk %}">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-sm btn-success">ðŸ›’ AÃ±adir al carrito</button>
                        </form>
                    {% else %}
                        <a href="{% url 'account_login' %}?next={% url 'product_list' %}" class="btn btn-sm btn-outline-secondary ms-auto">IniciÃ¡ sesiÃ³n para comprar</a>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </div>
</div>